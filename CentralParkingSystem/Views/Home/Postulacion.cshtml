@model ApiBD.Models.Home.IndexVM;
@{
    ViewData["Title"] = "Postulacion";
}

<!-- Page Header Start -->
<div class="container-fluid page-header py-6 wow fadeIn" data-wow-delay="0.1s">
    <div class="container text-center">
        <h1 class="display-4 text-white animated slideInDown mb-4">Postulacion</h1>
        <nav aria-label="breadcrumb animated slideInDown">
            <ol class="breadcrumb justify-content-center mb-0">
                <li class="breadcrumb-item"><a class="text-white" href="index.html">Inicio</a></li>
                <li class="breadcrumb-item text-primary active" aria-current="page">Postulacion</li>
            </ol>
        </nav>
    </div>
</div>
<!-- Page Header End -->
<!-- Cuerpo page Start -->
<div class="container-xxl border border-secondary py-6 bg-light">
    <div class="container">
        <div class="row mb-2">
            <div class="col">
                <div class="section_title text-center">
                    <h2>Bienvenido!</h2>
                    <p>Al sistema de reclutamiento de Central Parking System.</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="accordion_container col-lg-12">
                <div class="row justify-content-center">
                    <form asp-action="Postulacion" enctype="multipart/form-data" onsubmit="bloquearFormulario()">

                        <div class="form-group row mb-2">
                            <label for="state_id" class="col-sm-2 col-form-label">Tipo Documento</label>
                            <div class="col-sm-5">
                                <select class="form-control" asp-for="@Model.TbFormTbcnosotros.TipoDocumento" placeholder="Tipo Documento" required>
                                    <option value="1">DNI</option>
                                    <option value="2">CARNÉT DE EXTRANJERIA</option>
                                    <option value="3">PASAPORTE</option>
                                </select>
                            </div>
                            <label for="inputEmail3" class="col-sm-1 col-form-label">Nro. Doc</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" asp-for="@Model.TbFormTbcnosotros.NumeroDocumento"
                                       placeholder="Nro. Documento" required>
                            </div>
                        </div>
                        <div class="form-group row mb-2">
                            <label for="Nombres" class="col-sm-2 col-form-label">Nombres</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" asp-for="@Model.TbFormTbcnosotros.Nombre"
                                       placeholder="Nombres" required>
                            </div>
                        </div>
                        <div class="form-group row mb-2">
                            <label for="Apellidos" class="col-sm-2 col-form-label">Apellidos</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" 
                                       placeholder="Apellidos" asp-for="@Model.TbFormTbcnosotros.Apellido" required>
                            </div>
                        </div>
                        <div class="form-group row mb-2">
                            <label for="Nac" class="col-sm-2 col-form-label">Fecha Nac.</label>
                            <div class="col-sm-5">
                                <input type="date" class="form-control" asp-for="@Model.TbFormTbcnosotros.FechaNacimiento" placeholder="Nac" required>
                            </div>
                            <label for="Telf" class="col-sm-1 col-form-label">Celular</label>
                            <div class="col-sm-4">
                                <input type="text" class="form-control" asp-for="@Model.TbFormTbcnosotros.Celular" id="Telf" placeholder="Telf" required>
                            </div>
                        </div>
                        <div class="form-group row mb-2">
                            <label for="inputEmail3" class="col-sm-2 col-form-label">Correo Electrónico</label>
                            <div class="col-sm-5">
                                <input type="email" class="form-control" asp-for="@Model.TbFormTbcnosotros.CorreoElectronico" placeholder="Email" required>
                            </div>
                            <label for="inputEmail3" class="col-sm-1 col-form-label">Medio</label>
                            <div class="col-sm-4">
                                <select asp-for="@Model.TbFormTbcnosotros.Medio" class="form-control" id="cbxMedio" placeholder="Medio">
                                    <option value="PAGINA">PAGINA WEB</option>
                                    <option value="RADIO">RADIO</option>
                                    <option value="TV">TV</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row mb-2">
                            <label for="Departamento" class="col-sm-2 col-form-label">Departamento </label>
                            <div class="col-sm-10">
                                <select asp-for="@Model.TbFormTbcnosotros.Departamento" class="form-control" placeholder="Departamento" asp-items="ViewBag.DptoId" onchange="loadProvincias(this.value)" required>
                                    <option value="">Seleccione un departamento</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row mb-2">
                            <label for="Provincia" class="col-sm-2 col-form-label">Provincia </label>
                            <div class="col-sm-10">
                                <select asp-for="@Model.TbFormTbcnosotros.Provincia" class="form-control" onchange="loadDistritos(this.value)"  placeholder="Provincia" required>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row mb-2">
                            <label for="Distrito" class="col-sm-2 col-form-label">Distrito </label>
                            <div class="col-sm-10">
                                <select class="form-control" asp-for="@Model.TbFormTbcnosotros.Distrito" placeholder="Distrito" required>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row mb-2">
                            <label for="inputPuesto" class="col-sm-2 col-form-label">Puesto</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" asp-for="@Model.TbFormTbcnosotros.Puesto" readOnly/>
                            </div>
                        </div>
                        <div class="form-group row mb-2">
                            <div class="col-sm-2">Información Adicional</div>
                            <div class="col-sm-10">
                                <div class="custom-file">
                                    <input asp-for="@Model.InformacionAdicionalFile" 
                                       type="file" 
                                       class="custom-file-input" 
                                       required
                                       accept=".pdf"
                                       maxlength="5242880">
                                    <br />
                                    <small class="form-text text-muted">Tipo de documento recomendado: PDF. Peso maximo: 5MB.</small>
                                    <br />
                                    <span id="txtValidaPesoArchivo" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row mb-2">
                            <div class="col-sm-12 text-center">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    Registrar mi postulación <i id="spinnerIcon" class="fas fa-check-square"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var inputFile = document.querySelector('input[type="file"]');
        var errorSpan = document.getElementById('txtValidaPesoArchivo');
        inputFile.addEventListener('change', function () {
            var fileSize = this.files[0].size; // Tamaño del archivo en bytes
            var maxSize = 5 * 1024 * 1024; // 5 MB en bytes

            if (fileSize > maxSize) {
                errorSpan.textContent = 'El archivo no debe superar 5 MB de tamaño.';
                this.value = ''; // Limpiar el campo de entrada de archivos
            } else {
                errorSpan.textContent = ''; // Limpiar el mensaje de error si no hay error
            }
        });

        // Capturar el envío del formulario
        document.querySelector('form').addEventListener('submit', function (event) {
            var fileSize = inputFile.files[0].size; // Tamaño del archivo en bytes
            var maxSize = 5 * 1024 * 1024; // 5 MB en bytes

            if (fileSize > maxSize) {
                errorSpan.textContent = 'El archivo no debe superar 5 MB de tamaño.';
                event.preventDefault(); // Prevenir el envío del formulario
            } else {
                errorSpan.textContent = ''; // Limpiar el mensaje de error si no hay error
            }
        });
    });

    function bloquearFormulario() {
        var button = document.querySelector('button[type="submit"]');
        button.disabled = true;
        var spinnerIcon = $('#spinnerIcon');
        spinnerIcon.addClass('fa fa-spinner fa-pulse');
    }

    function loadProvincias(departamentoId) {
        // Limpiar el combo de provincias y distritos
        document.getElementById("TbFormTbcnosotros_Provincia").innerHTML = '<option value="">Seleccione una provincia</option>';
        document.getElementById("TbFormTbcnosotros_Distrito").innerHTML = '<option value="">Seleccione un distrito</option>';

        // Si no se seleccionó ningún departamento, salir
        if (!departamentoId) return;

        // Realizar la solicitud AJAX para obtener las provincias
        fetch(`/Home/GetProvincias?departamentoId=${departamentoId}`)
            .then(response => response.json())
            .then(data => {
                // Llenar el combo de provincias con los datos recibidos
                data.forEach(provincia => {
                    var option = document.createElement("option");
                    option.value = provincia.codUbi; // Ajustar según tu modelo
                    option.text = provincia.prov; // Ajustar según tu modelo
                    document.getElementById("TbFormTbcnosotros_Provincia").appendChild(option);
                });
            });
    }

    function loadDistritos(provinciaId) {
        // Limpiar el combo de distritos
        document.getElementById("TbFormTbcnosotros_Distrito").innerHTML = '<option value="">Seleccione un distrito</option>';

        // Si no se seleccionó ninguna provincia, salir
        if (!provinciaId) return;

        // Realizar la solicitud AJAX para obtener los distritos
        fetch(`/Home/GetDistritos?provinciaId=${provinciaId}`)
            .then(response => response.json())
            .then(data => {
                // Llenar el combo de distritos con los datos recibidos
                data.forEach(distrito => {
                    var option = document.createElement("option");
                    option.value = distrito.codUbi; // Ajustar según tu modelo
                    option.text = distrito.dist; // Ajustar según tu modelo
                    document.getElementById("TbFormTbcnosotros_Distrito").appendChild(option);
                });
            });
    }
    loadProvincias("15");
    document.getElementById("TbFormTbcnosotros_Provincia").value = "1501";
    loadProvincias("1501");
</script>